<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--************************************************************************************
* Program Name : EQ0301
* Description : 기술문서
* Author :
* Created Date :
* SQL 목록
***************************************************************************************
* SQLID                 설명
***************************************************************************************
* retrieveEQ0301List : 메뉴 목록 조회
* insertEQ0301 : 기술문서 목록 추가
* updateEQ0301 : 기술문서 목록 수정
* deleteEQ0301 : 기술문서 목록 삭제
*************************************************************************************-->
<mapper namespace="kc0301">
    <select id="retrieveKC0201List" parameterType="map" resultType="map" >
        <![CDATA[ /* eq0301.retrieveEQ0301List */ ]]>
	       SELECT
	       	  X.COMPANY_CD
	       	, X.DOC_ID
	       	, X.DOC_TP
	       	, X.DOC_TITLE
	       	, X.SHARE_YN
	       	, X.USE_YN
	       	, ( SELECT STRING_AGG(Q.FILE_NM,',') WITHIN GROUP(ORDER BY Q.FILE_ID)
                   FROM SC_FILE Q
                  WHERE Q.FILE_ATCH_ID = X.FILE_ATCH_ID
             ) FILE_NM
	       	, X.FILE_ATCH_ID
	       	, X.ORG_CD
	       	, X.CMMNT
	       	, X.FST_REG_USER_ID
	       	, X.FST_REG_DT
	       	, X.FNL_EDIT_USER_ID
	       	, X.FNL_EDIT_DT
	       FROM KC0201M X
	       WHERE 1=1
	       <if test="companyCd != ''">
	       		AND X.COMPANY_CD = #{companyCd}
	       </if>
	       <if test="docTP != ''">
	       		AND X.DOC_TP = #{docTP}
	       </if>
	       <if test="docTitle != ''">
	       		AND X.DOC_TITLE = #{docTitle}
	       </if>
	       <if test="useYn != ''">
	       		AND X.USE_YN = #{useYn}
	       </if>
	       <if test="shareYn != ''">
	       		AND X.SHARE_YN = #{shareYn}
	       </if>
    </select>

 <!-- 설비 정보 저장  -->
    <insert id="insertKC0201" parameterType="map" >
        <![CDATA[ /* eq0301.insertEQ0301 */ ]]>

        INSERT INTO KC0201M (
        	COMPANY_CD
        	, DOC_ID
        	, DOC_TP
        	, DOC_TITLE
        	, SHARE_YN
        	, USE_YN
        	, FILE_ATCH_ID
        	, ORG_CD
        	, CMMNT
        	, FST_REG_USER_ID
        	, FST_REG_DT
        	, FNL_EDIT_USER_ID
        	, FNL_EDIT_DT)
        VALUES(
        	#{companyCd}
        	, #{docId}
        	, #{docTp}
        	, #{docTitle}
        	, #{shareYn}
        	, #{useYn}
        	<if test="fileAtchId == ''">
             , null
             </if>
             <if test="fileAtchId != ''">
             , #{fileAtchId}
             </if>
             , #{orgCd}
             , #{cmmnt}
             , #{fstRegUserId}
             , GETDATE()
             , #{fnlEditUserId}
             , GETDATE()
        );

    </insert>

 <!-- 해당 설비ID정보 수정 -->
    <update id="updateKC0201" parameterType="map" >
        <![CDATA[ /* eq0301.updateEQ0301 */ ]]>
        UPDATE KC0201M
           SET
             <if test="fileAtchId == ''">
               FILE_ATCH_ID     = null
             </if>
             <if test="fileAtchId != ''">
               FILE_ATCH_ID     = #{fileAtchId}
             </if>
             , DOC_TITLE           = #{docTitle}
             , DOC_TP           = #{docTp}
             , CMMNT             = #{cmmnt}
             , USE_YN             = #{useYn}
             , SHARE_YN            = #{shareYn}
             , FNL_EDIT_DT       = GETDATE()
             , FNL_EDIT_USER_ID  = #{fnlEditUserId}
         WHERE DOC_ID           = #{docId}
           AND COMPANY_CD        = #{companyCd}
    </update>

    <!-- 해당 설비ID 삭제 -->
    <delete id="deleteKC0201" parameterType="map" >
        <![CDATA[ /* eq0301.deleteEQ0301 */ ]]>
        DELETE
          FROM KC0201M
         WHERE DOC_ID           = #{docId}
           AND COMPANY_CD        = #{companyCd}
    </delete>

</mapper>