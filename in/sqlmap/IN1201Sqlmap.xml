<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--************************************************************************************
* Program Name : 일상점검결과 작성
* Description : 일상점검결과 작성 검색
* Author : jit13
* Created Date :
* SQL 목록
***************************************************************************************
* SQLID                 설명
***************************************************************************************
* retrieveIN0401    : 일상점검결과 작성 조회
* retrieveIN0401Sub : 일상점검결과 작성 상세목록 조회
*************************************************************************************-->
<mapper namespace="in1201">
    <!-- 일상점검결과 조회 -->
    <select id="retrieveIN1201" parameterType="map" resultType="map" >
        <![CDATA[ /* in1201.retrieveIN1201 */ ]]>
        SELECT X.CHK_NO
             , X.COMPANY_CD
             , z.CHK_NM
             , X.CHK_DTL_NO
             , X.CHK_DTL_NM
             , X.SEQ_NO
             , X.CHK_METHOD
             , X.CHK_PART_DESC
             , X.INPUT_TP
             , CASE WHEN X.INPUT_TP = 'STS' THEN ''
			   ELSE CONVERT(VARCHAR, X.CHK_STD_VAL) END CHK_STD_VAL
             , CASE WHEN INPUT_TP = 'STS' THEN ''
			   ELSE CONVERT(VARCHAR, X.CHK_MIN_VAL) END CHK_MIN_VAL
             , CASE WHEN X.INPUT_TP = 'STS' THEN ''
			   ELSE CONVERT(VARCHAR, X.CHK_MAX_VAL) END CHK_MAX_VAL
             , CASE WHEN X.INPUT_TP = 'STS' THEN ''
			   ELSE CONVERT(VARCHAR, X.WARN_MIN_VAL) END WARN_MIN_VAL
             , CASE WHEN X.INPUT_TP = 'STS' THEN ''
			   ELSE CONVERT(VARCHAR, X.WARN_MAX_VAL) END WARN_MAX_VAL
             , CASE WHEN X.INPUT_TP = 'STS' THEN ''
			   ELSE CONVERT(VARCHAR, Y.CHK_VAL) END CHK_VAL
             , Z.DAY_YN
             , Y.CHK_RSLT_NO
             , Y.CHK_STS
             , ISNULL(Y.CHK_YMD, CONVERT(VARCHAR, GETDATE(), 23)) AS CHK_YMD
             , Y.CHK_TIME
             , Y.CHK_USER_ID
             , (SELECT USER_NM FROM SC_USER WHERE USER_ID = Y.CHK_USER_ID AND COMPANY_CD = #{companyCd})          CHK_USER_DESC
             , Y.CHK_YN
             , X.UNIT_CD
             , (SELECT UNIT_NM FROM CO0401M WHERE UNIT_CD = X.UNIT_CD AND COMPANY_CD = #{companyCd}) UNIT_NM
             , Y.CMMNT
             , Y.CMMNT RESULT_CMMNT
             , Y.FILE_ATCH_ID
             , (SELECT COUNT(*) FROM SC_FILE WHERE FILE_ATCH_ID = Y.FILE_ATCH_ID) AS FILE_CNT
             , Z.EQ_NO
             , A.EQ_NM
          FROM IN0401D Y
          LEFT OUTER JOIN IN0201D X ON (X.CHK_DTL_NO = Y.CHK_DTL_NO AND X.COMPANY_CD = Y.COMPANY_CD)
         INNER JOIN IN0201M Z ON (X.CHK_NO = Z.CHK_NO AND Z.DAY_YN = 'Y' AND X.COMPANY_CD = Z.COMPANY_CD)
         INNER JOIN EQ0101M A ON (Z.EQ_NO = A.EQ_NO AND Z.COMPANY_CD = A.COMPANY_CD)
         WHERE 1=1
           AND Y.COMPANY_CD = #{companyCd}
        <if test="fStartChkDate != null &amp;&amp; fStartChkDate != '' &amp;&amp; fEndChkDate != null &amp;&amp; fEndChkDate != ''">
           AND Y.CHK_YMD BETWEEN #{fStartChkDate} AND  #{fEndChkDate}
        </if>
        <if test="feqNo != null &amp;&amp; feqNo != ''">
           AND Z.EQ_NO = #{feqNo}
        </if>
        <if test="forgCd != null &amp;&amp; forgCd != ''">
           AND Z.ORG_CD IN (${forgCd})
        </if>
        <if test="fchkUserId != null &amp;&amp; fchkUserId != ''">
           AND UPPER(Y.CHK_USER_ID) LIKE '%' + UPPER(#{fchkUserId}) + '%'
        </if>
        <if test="fchkNm != null &amp;&amp; fchkNm != ''">
           AND UPPER(Z.CHK_NM) LIKE '%' + UPPER(#{fchkNm}) + '%'
        </if>
        <if test="flineCd != null &amp;&amp; flineCd != ''">
           AND A.EQ_LINE IN (${flineCd})
        </if>
    </select>

</mapper>