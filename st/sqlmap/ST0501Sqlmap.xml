<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--************************************************************************************
* Program Name : 작업오더집계작성
* CHART_NM : 작업오더집계작성
* Author : jit13
* Created Date :
* SQL 목록
***************************************************************************************
* SQLID                 설명
***************************************************************************************
* retrieveMT0501     : 작업오더집계 목록 조회
*************************************************************************************-->
<mapper namespace="st0501">
    <!-- 작업오더집계작성 조회 -->
    <select id="retrieveST0501Chart" parameterType="map" resultType="map" >
        <![CDATA[ /* st0501.retrieveST0501Chart */ ]]>
        <if test='fcon == "A"'>
        SELECT
               '"' + dbo.FN_NAME(REQ_ORG_CD,'DEPT') + '"' CHART_NM
             , SUM(COMP) COMP
             , SUM(UNDECIDED) UNDECIDED
             , SUM(CANCELED) CANCELED
          FROM (
                SELECT
                       Y.REQ_ORG_CD
                     , 1 PUB
                     , CASE WHEN X.WO_STS = 'YZ' THEN 1 ELSE 0 END COMP
					 , CASE WHEN X.WO_STS = 'BX' THEN 0 WHEN X.WO_STS = 'CX' THEN 0 WHEN X.WO_STS = 'YZ' THEN 0 ELSE 1 END UNDECIDED
					 , CASE WHEN X.WO_STS = 'BX' THEN 1 WHEN X.WO_STS = 'CX' THEN 1 ELSE 0 END CANCELED
                  FROM WO0201M X
				 INNER JOIN WO0101M Y ON (Y.REQ_NO = X.REQ_NO AND Y.COMPANY_CD = X.COMPANY_CD)
                 WHERE Y.REQ_ORG_CD IS NOT NULL
                   AND X.EQ_NO IS NOT NULL
                   AND X.COMPANY_CD = #{companyCd}
                <if test="fStartDate != null &amp;&amp; fStartDate != ''">
                   AND CONVERT(VARCHAR, ISNULL(Y.FST_REG_DT, X.FST_REG_DT), 23) <![CDATA[ >=]]> #{fStartDate}
                </if>
                <if test="fEndDate != null &amp;&amp; fEndDate != ''">
                   AND CONVERT(VARCHAR, ISNULL(Y.FST_REG_DT, X.FST_REG_DT), 23) <![CDATA[ <=]]> #{fEndDate}
                </if>
               ) A
         GROUP BY REQ_ORG_CD
        </if>
        <if test='fcon == "B"'>
        SELECT
               '"' + dbo.FN_NAME(ORG_CD,'DEPT') + '"' CHART_NM
             , SUM(COMP) COMP
             , SUM(UNDECIDED) UNDECIDED
             , SUM(CANCELED) CANCELED
          FROM (
                SELECT
                       X.ORG_CD
                     , 1 PUB
                     , CASE WHEN X.WO_STS = 'YZ' THEN 1 ELSE 0 END COMP
					 , CASE WHEN X.WO_STS = 'BX' THEN 0 WHEN X.WO_STS = 'CX' THEN 0 WHEN X.WO_STS = 'YZ' THEN 0 ELSE 1 END UNDECIDED
					 , CASE WHEN X.WO_STS = 'BX' THEN 1 WHEN X.WO_STS = 'CX' THEN 1 ELSE 0 END CANCELED
                  FROM WO0201M X
                  LEFT OUTER JOIN WO0101M Y ON (Y.REQ_NO = X.REQ_NO AND Y.COMPANY_CD = X.COMPANY_CD)
                 WHERE X.ORG_CD IS NOT NULL
                   AND X.EQ_NO IS NOT NULL
                   AND X.COMPANY_CD = #{companyCd}
                <if test="fStartDate != null &amp;&amp; fStartDate != ''">
                   AND CONVERT(VARCHAR, ISNULL(Y.FST_REG_DT, X.FST_REG_DT), 23) <![CDATA[ >=]]> #{fStartDate}
                </if>
                <if test="fEndDate != null &amp;&amp; fEndDate != ''">
                   AND CONVERT(VARCHAR, ISNULL(Y.FST_REG_DT, X.FST_REG_DT), 23) <![CDATA[ <=]]> #{fEndDate}
                </if>
               ) A
         GROUP BY ORG_CD
        </if>
        <if test='fcon == "C"'>
        SELECT
               (SELECT CLS_NM FROM EQ0201M WHERE CLS_CD = Y.EQ_LINE AND CLS_TYPE = 'E' AND EQ_CLS = 'EQ_PRCS') CHART_NM
             , SUM(COMP) COMP
             , SUM(UNDECIDED) UNDECIDED
             , SUM(CANCELED) CANCELED
          FROM (
                SELECT
                       X.EQ_NO
                     , DBO.FN_NAME(X.EQ_NO, 'EQ_LINE') AS EQ_LINE
                     , 1 PUB
                     , CASE WHEN X.WO_STS = 'YZ' THEN 1 ELSE 0 END COMP
                     , CASE WHEN X.WO_STS = 'BX' THEN 0 WHEN X.WO_STS = 'CX' THEN 0 WHEN X.WO_STS = 'YZ' THEN 0 ELSE 1 END UNDECIDED
                     , CASE WHEN X.WO_STS = 'BX' THEN 1 WHEN X.WO_STS = 'CX' THEN 1 ELSE 0 END CANCELED
                  FROM WO0201M X
                  INNER JOIN EQ0101M Z ON (Z.EQ_NO = X.EQ_NO AND Z.COMPANY_CD = X.COMPANY_CD)
                 LEFT OUTER JOIN WO0101M Y ON (Y.REQ_NO = X.REQ_NO AND Y.COMPANY_CD = X.COMPANY_CD)
                 WHERE Z.REV_NO = #{revNo}
                   AND X.EQ_NO IS NOT NULL
                   AND X.COMPANY_CD = #{companyCd}
                <if test="fStartDate != null &amp;&amp; fStartDate != ''">
                   AND CONVERT(VARCHAR, ISNULL(Y.FST_REG_DT, X.FST_REG_DT), 23)<![CDATA[ >=]]> #{fStartDate}
                </if>
                <if test="fEndDate != null &amp;&amp; fEndDate != ''">
                   AND CONVERT(VARCHAR, ISNULL(Y.FST_REG_DT, X.FST_REG_DT), 23)<![CDATA[ <=]]> #{fEndDate}
                </if>
               ) Y
          	WHERE 1=1
              <if test="flineCd != null &amp;&amp; flineCd != ''">
          	  AND Y.EQ_LINE IN (${flineCd})
              </if>
         GROUP BY Y.EQ_LINE
        </if>
    </select>

    <select id="retrieveST0501List" parameterType="map" resultType="map" >
        <![CDATA[ /* st0501.retrieveST0501List */ ]]>
        <if test='fcon == "A"'>
        SELECT
               REQ_ORG_CD CHART_CD
             , dbo.FN_NAME(REQ_ORG_CD,'DEPT') CHART_NM
             , SUM(PUB) PUB
             , SUM(COMP) COMP
             , SUM(UNDECIDED) UNDECIDED
             , SUM(CANCELED) CANCELED
             , CASE SUM(PUB)-SUM(CANCELED) WHEN '0' THEN '0' ELSE ROUND(100*SUM(COMP)/(SUM(PUB)-SUM(CANCELED)),2) END COMRATE
          FROM (
                SELECT
                       Y.REQ_ORG_CD
                     , 1 PUB
                     , CASE WHEN X.WO_STS = 'YZ' THEN 1 ELSE 0 END COMP
					 , CASE WHEN X.WO_STS = 'BX' THEN 0 WHEN X.WO_STS = 'CX' THEN 0 WHEN X.WO_STS = 'YZ' THEN 0 ELSE 1 END UNDECIDED
					 , CASE WHEN X.WO_STS = 'BX' THEN 1 WHEN X.WO_STS = 'CX' THEN 1 ELSE 0 END CANCELED
                  FROM WO0201M X
                 INNER JOIN WO0101M Y ON (Y.REQ_NO = X.REQ_NO AND Y.COMPANY_CD = X.COMPANY_CD)
                 WHERE Y.REQ_ORG_CD IS NOT NULL
                   AND X.EQ_NO IS NOT NULL
                   AND X.COMPANY_CD = #{companyCd}
                <if test="fStartDate != null &amp;&amp; fStartDate != ''">
                   AND CONVERT(VARCHAR, ISNULL(Y.FST_REG_DT, X.FST_REG_DT), 23)<![CDATA[ >=]]> #{fStartDate}
                </if>
                <if test="fEndDate != null &amp;&amp; fEndDate != ''">
                   AND CONVERT(VARCHAR, ISNULL(Y.FST_REG_DT, X.FST_REG_DT), 23)<![CDATA[ <=]]> #{fEndDate}
                </if>
               ) A
                 GROUP BY REQ_ORG_CD
                UNION ALL
                SELECT
                       '계'
                     , ''
                     , SUM(PUB)
                     , SUM(COMP)
                     , SUM(UNDECIDED)
                     , SUM(CANCELED)
                     , CASE SUM(PUB)-SUM(CANCELED) WHEN '0' THEN '0' ELSE ROUND(100*SUM(COMP)/(SUM(PUB)-SUM(CANCELED)),2) END COMRATE
                  FROM (
                        SELECT
                               'name' NAME
                             , 1 PUB
                             , CASE WHEN X.WO_STS = 'YZ' THEN 1 ELSE 0 END COMP
					         , CASE WHEN X.WO_STS = 'BX' THEN 0 WHEN X.WO_STS = 'CX' THEN 0 WHEN X.WO_STS = 'YZ' THEN 0 ELSE 1 END UNDECIDED
					         , CASE WHEN X.WO_STS = 'BX' THEN 1 WHEN X.WO_STS = 'CX' THEN 1 ELSE 0 END CANCELED
                          FROM WO0201M x
                         INNER JOIN WO0101M y ON (y.REQ_NO = x.REQ_NO AND Y.COMPANY_CD = X.COMPANY_CD)
                         WHERE Y.REQ_ORG_CD IS NOT NULL
                           AND X.EQ_NO IS NOT NULL
                           AND X.COMPANY_CD = #{companyCd}
                        <if test="fStartDate != null &amp;&amp; fStartDate != ''">
                           AND CONVERT(VARCHAR, ISNULL(Y.FST_REG_DT, X.FST_REG_DT), 23)<![CDATA[ >=]]> #{fStartDate}
                        </if>
                        <if test="fEndDate != null &amp;&amp; fEndDate != ''">
                           AND CONVERT(VARCHAR, ISNULL(Y.FST_REG_DT, X.FST_REG_DT), 23)<![CDATA[ <=]]> #{fEndDate}
                        </if>
                       ) A
                 GROUP BY NAME
        </if>
        <if test='fcon == "B"'>
        SELECT
               ORG_CD CHART_CD
             , dbo.FN_NAME(ORG_CD,'DEPT') CHART_NM
             , SUM(PUB) PUB
             , SUM(COMP) COMP
             , SUM(UNDECIDED) UNDECIDED
             , SUM(CANCELED) CANCELED
             , CASE SUM(PUB)-SUM(CANCELED) WHEN '0' THEN '0' ELSE ROUND(100*SUM(COMP)/(SUM(PUB)-SUM(CANCELED)),2) END COMRATE
          FROM (
                SELECT
                       X.ORG_CD
                     , 1 PUB
                     , CASE WHEN X.WO_STS = 'YZ' THEN 1 ELSE 0 END COMP
			         , CASE WHEN X.WO_STS = 'BX' THEN 0 WHEN X.WO_STS = 'CX' THEN 0 WHEN X.WO_STS = 'YZ' THEN 0 ELSE 1 END UNDECIDED
			         , CASE WHEN X.WO_STS = 'BX' THEN 1 WHEN X.WO_STS = 'CX' THEN 1 ELSE 0 END CANCELED
                  FROM WO0201M X
                  LEFT OUTER JOIN WO0101M Y ON (Y.REQ_NO = X.REQ_NO AND Y.COMPANY_CD = X.COMPANY_CD)
                 WHERE X.ORG_CD IS NOT NULL
                   AND X.EQ_NO IS NOT NULL
                   AND X.COMPANY_CD = #{companyCd}
                <if test="fStartDate != null &amp;&amp; fStartDate != ''">
                   AND CONVERT(VARCHAR, ISNULL(Y.FST_REG_DT, X.FST_REG_DT), 23)<![CDATA[ >=]]> #{fStartDate}
                </if>
                <if test="fEndDate != null &amp;&amp; fEndDate != ''">
                   AND CONVERT(VARCHAR, ISNULL(Y.FST_REG_DT, X.FST_REG_DT), 23)<![CDATA[ <=]]> #{fEndDate}
                </if>
               ) A
         GROUP BY ORG_CD
        UNION ALL
        SELECT
               '계'
             , ''
             , SUM(PUB)
             , SUM(COMP)
             , SUM(UNDECIDED)
             , SUM(CANCELED)
             , CASE SUM(PUB)-SUM(CANCELED) WHEN '0' THEN '0' ELSE ROUND(100*SUM(COMP)/(SUM(PUB)-SUM(CANCELED)),2) END COMRATE
          FROM (
                SELECT
                       'name' NAME
                     , 1 PUB
                     , CASE WHEN X.WO_STS = 'YZ' THEN 1 ELSE 0 END COMP
			         , CASE WHEN X.WO_STS = 'BX' THEN 0 WHEN X.WO_STS = 'CX' THEN 0 WHEN X.WO_STS = 'YZ' THEN 0 ELSE 1 END UNDECIDED
			         , CASE WHEN X.WO_STS = 'BX' THEN 1 WHEN X.WO_STS = 'CX' THEN 1 ELSE 0 END CANCELED
                  FROM WO0201M X
                 LEFT OUTER JOIN WO0101M Y ON (Y.REQ_NO = X.REQ_NO AND Y.COMPANY_CD = X.COMPANY_CD)
                 WHERE X.ORG_CD IS NOT NULL
                   AND X.EQ_NO IS NOT NULL
                   AND X.COMPANY_CD = #{companyCd}
                <if test="fStartDate != null &amp;&amp; fStartDate != ''">
                   AND CONVERT(VARCHAR, ISNULL(Y.FST_REG_DT, X.FST_REG_DT), 23)<![CDATA[ >=]]> #{fStartDate}
                </if>
                <if test="fEndDate != null &amp;&amp; fEndDate != ''">
                   AND CONVERT(VARCHAR, ISNULL(Y.FST_REG_DT, X.FST_REG_DT), 23)<![CDATA[ <=]]> #{fEndDate}
                </if>
               ) A
         GROUP BY NAME
        </if>
        <if test='fcon == "C"'>
        SELECT
                EQ_LINE CHART_CD
              , (SELECT CLS_NM FROM EQ0201M WHERE CLS_CD = Y.EQ_LINE AND CLS_TYPE = 'E' AND EQ_CLS = 'EQ_PRCS') CHART_NM
              , SUM(PUB) PUB
              , SUM(COMP) COMP
              , SUM(UNDECIDED) UNDECIDED
              , SUM(CANCELED) CANCELED
              , CASE SUM(PUB)-SUM(CANCELED) WHEN '0' THEN '0' ELSE ROUND(100*SUM(COMP)/(SUM(PUB)-SUM(CANCELED)),2) END COMRATE
           FROM (
                 SELECT
                        X.EQ_NO
                      , DBO.FN_NAME(X.EQ_NO, 'EQ_LINE') AS EQ_LINE
                      , 1 PUB
                      , CASE WHEN X.WO_STS = 'YZ' THEN 1 ELSE 0 END COMP
			          , CASE WHEN X.WO_STS = 'BX' THEN 0 WHEN X.WO_STS = 'CX' THEN 0 WHEN X.WO_STS = 'YZ' THEN 0 ELSE 1 END UNDECIDED
			          , CASE WHEN X.WO_STS = 'BX' THEN 1 WHEN X.WO_STS = 'CX' THEN 1 ELSE 0 END CANCELED
                   FROM WO0201M X
                  INNER JOIN EQ0101M Z ON (Z.EQ_NO = X.EQ_NO AND Z.COMPANY_CD = X.COMPANY_CD)
                   LEFT OUTER JOIN WO0101M Y ON (Y.REQ_NO = X.REQ_NO AND Y.COMPANY_CD = X.COMPANY_CD)
                  WHERE Z.REV_NO = #{revNo}
                    AND X.EQ_NO IS NOT NULL
                    AND X.COMPANY_CD = #{companyCd}
                    <if test="finputNo != null &amp;&amp; finputNo != ''">
                    AND X.EQ_NO IN (
                        SELECT EQ_NO FROM T WHERE REV_NO = #{revNo}
                    )
                    </if>
                 <if test="fStartDate != null &amp;&amp; fStartDate != ''">
                   AND  CONVERT(VARCHAR, ISNULL(Y.FST_REG_DT, X.FST_REG_DT), 23)<![CDATA[ >=]]> #{fStartDate}
                 </if>
                 <if test="fEndDate != null &amp;&amp; fEndDate != ''">
                   AND  CONVERT(VARCHAR, ISNULL(Y.FST_REG_DT, X.FST_REG_DT), 23)<![CDATA[ <=]]> #{fEndDate}
                 </if>
                ) Y
          WHERE 1=1
            <if test="flineCd != null &amp;&amp; flineCd != ''">
            AND Y.EQ_LINE IN (${flineCd})
            </if>
          GROUP BY EQ_LINE
         UNION ALL
         SELECT
                '계'
              , ''
              , SUM(PUB)
              , SUM(COMP)
              , SUM(UNDECIDED)
              , SUM(CANCELED)
              , CASE SUM(PUB)-SUM(CANCELED) WHEN '0' THEN '0' ELSE ROUND(100*SUM(COMP)/(SUM(PUB)-SUM(CANCELED)),2) END COMRATE
           FROM (
                 SELECT
                        'name' NAME
                      , DBO.FN_NAME(X.EQ_NO, 'EQ_LINE') AS EQ_LINE
                      , 1 PUB
                      , CASE WHEN X.WO_STS = 'YZ' THEN 1 ELSE 0 END COMP
			          , CASE WHEN X.WO_STS = 'BX' THEN 0 WHEN X.WO_STS = 'CX' THEN 0 WHEN X.WO_STS = 'YZ' THEN 0 ELSE 1 END UNDECIDED
			          , CASE WHEN X.WO_STS = 'BX' THEN 1 WHEN X.WO_STS = 'CX' THEN 1 ELSE 0 END CANCELED
                   FROM WO0201M X
                   LEFT OUTER JOIN WO0101M Y ON (Y.REQ_NO = X.REQ_NO AND Y.COMPANY_CD = X.COMPANY_CD)
                  WHERE X.EQ_NO IS NOT NULL
                    AND X.COMPANY_CD = #{companyCd}
                    <if test="flineCd != null &amp;&amp; flineCd != ''">
          	        AND DBO.FN_NAME(X.EQ_NO, 'EQ_LINE') IN (${flineCd})
                    </if>

                    <if test="fStartDate != null &amp;&amp; fStartDate != ''">
                    AND CONVERT(VARCHAR, ISNULL(Y.FST_REG_DT, X.FST_REG_DT), 23)<![CDATA[ >=]]> #{fStartDate}
                    </if>
                    <if test="fEndDate != null &amp;&amp; fEndDate != ''">
                    AND CONVERT(VARCHAR, ISNULL(Y.FST_REG_DT, X.FST_REG_DT), 23)<![CDATA[ <=]]> #{fEndDate}
                    </if>
               ) A
          WHERE 1=1
          GROUP BY NAME
        </if>
    </select>

    <select id="retrieveST0501SubList" parameterType="map" resultType="map" >
        <![CDATA[ /* st0501.retrieveST0501SubList */ ]]>
        <if test='fcon == "A"'>
        SELECT
               X.WO_NO
             , X.COMPANY_CD
             , X.WO_NM
             , dbo.FN_NAME(X.WO_TP,'WO_TP') WO_TP
             , dbo.FN_NAME(X.WO_STS, 'WO_STS') WO_STS
             , dbo.FN_NAME(Z.REQ_ORG_CD, 'DEPT') REQ_ORG_NM
             , Z.REQ_YMD
             , dbo.FN_NAME(X.PLAN_ORG_CD, 'DEPT') PLAN_ORG_NM
             , dbo.FN_NAME(X.ORG_CD, 'DEPT') ORG_NM
             , dbo.FN_NAME(Z.REQ_USER_ID, 'USER') REQ_USER_NM
             , dbo.FN_NAME(X.PLAN_USER_ID, 'USER') PLAN_USER_NM
             , dbo.FN_NAME(X.WORK_USER_ID, 'USER') WORK_USER_NM
             , Y.ITEM_NO
             , Y.EQ_NM
             , X.PLAN_START_YMD
             , X.PLAN_END_YMD
             , X.START_YMD
             , X.END_YMD
             , X.REQ_NO
             , X.EQ_NO
          FROM WO0201M X
         INNER JOIN EQ0101M Y ON (Y.EQ_NO = X.EQ_NO AND Y.COMPANY_CD = X.COMPANY_CD)
          LEFT OUTER JOIN WO0101M Z ON (Z.REQ_NO = X.REQ_NO AND Z.COMPANY_CD = X.COMPANY_CD)
         WHERE X.REQ_NO IS NOT NULL
           AND Y.REV_NO = #{revNo}
           AND X.COMPANY_CD = #{companyCd}
          <if test='fstatus == "comp"'>
           AND X.WO_STS = 'YZ'
          </if>
          <if test='fstatus == "undecided"'>
           AND X.WO_STS NOT IN ('YZ', 'BX', 'CX')
          </if>
          <if test='fstatus == "canceled"'>
           AND X.WO_STS IN ('BX', 'CX')
          </if>
          <if test="fStartDate != null &amp;&amp; fStartDate != ''">
           AND CONVERT(VARCHAR, ISNULL(Z.FST_REG_DT, X.FST_REG_DT), 23) <![CDATA[ >=]]> #{fStartDate}
          </if>
          <if test="fEndDate != null &amp;&amp; fEndDate != ''">
           AND CONVERT(VARCHAR, ISNULL(Z.FST_REG_DT, X.FST_REG_DT), 23) <![CDATA[ <=]]> #{fEndDate}
          </if>
          <if test="chartCd != null &amp;&amp; chartCd != ''">
           AND UPPER(Z.REQ_ORG_CD) = UPPER(#{chartCd})
          </if>
         ORDER BY X.wo_no DESC
        </if>
        <if test='fcon == "B"'>
        SELECT
               X.WO_NO
             , X.WO_NM
             , dbo.FN_NAME(X.WO_TP,'WO_TP') WO_TP
             , dbo.FN_NAME(X.WO_STS, 'WO_STS') WO_STS
             , dbo.FN_NAME(Z.REQ_ORG_CD, 'DEPT') REQ_ORG_NM
             , Z.REQ_YMD
             , dbo.FN_NAME(X.PLAN_ORG_CD, 'DEPT') PLAN_ORG_NM
             , dbo.FN_NAME(X.ORG_CD, 'DEPT') ORG_NM
             , dbo.FN_NAME(Z.REQ_USER_ID, 'USER') REQ_USER_NM
             , dbo.FN_NAME(X.PLAN_USER_ID, 'USER') PLAN_USER_NM
             , dbo.FN_NAME(X.WORK_USER_ID, 'USER') WORK_USER_NM
             , Y.ITEM_NO
             , Y.EQ_NM
             , X.PLAN_START_YMD
             , X.PLAN_END_YMD
             , X.START_YMD
             , X.END_YMD
             , X.REQ_NO
             , X.EQ_NO
             , X.ORG_CD
          FROM WO0201M X
         INNER JOIN EQ0101M Y ON (Y.EQ_NO = X.EQ_NO AND Y.COMPANY_CD = X.COMPANY_CD)
          LEFT OUTER JOIN WO0101M Z ON (Z.REQ_NO = X.REQ_NO AND Z.COMPANY_CD = X.COMPANY_CD)
         WHERE X.ORG_CD IS NOT NULL
           AND Y.REV_NO = #{revNo}
           AND X.COMPANY_CD = #{companyCd}
          <if test='fstatus == "comp"'>
           AND X.WO_STS = 'YZ'
          </if>
          <if test='fstatus == "undecided"'>
           AND X.WO_STS NOT IN ('YZ', 'BX', 'CX')
          </if>
          <if test='fstatus == "canceled"'>
           AND X.WO_STS IN ('BX', 'CX')
          </if>
          <if test="fStartDate != null &amp;&amp; fStartDate != ''">
           AND CONVERT(VARCHAR, ISNULL(Z.FST_REG_DT, X.FST_REG_DT), 23) <![CDATA[ >=]]> #{fStartDate}
          </if>
          <if test="fEndDate != null &amp;&amp; fEndDate != ''">
           AND CONVERT(VARCHAR, ISNULL(Z.FST_REG_DT, X.FST_REG_DT), 23) <![CDATA[ <=]]> #{fEndDate}
          </if>
          <if test="chartCd != null &amp;&amp; chartCd != ''">
           AND UPPER(X.ORG_CD) = UPPER(#{chartCd})
          </if>
         ORDER BY X.WO_NO DESC
        </if>
        <if test='fcon == "C"'>
        SELECT
               X.WO_NO
             , X.COMPANY_CD
             , X.WO_NM
             , dbo.FN_NAME(X.WO_TP,'WO_TP') WO_TP
             , dbo.FN_NAME(X.WO_STS, 'WO_STS') WO_STS
             , dbo.FN_NAME(Z.REQ_ORG_CD, 'DEPT') REQ_ORG_NM
             , Z.REQ_YMD
             , dbo.FN_NAME(X.PLAN_ORG_CD, 'DEPT') PLAN_ORG_NM
             , dbo.FN_NAME(X.ORG_CD, 'DEPT') ORG_NM
             , dbo.FN_NAME(Z.REQ_USER_ID, 'USER') REQ_USER_NM
             , dbo.FN_NAME(X.PLAN_USER_ID, 'USER') PLAN_USER_NM
             , dbo.FN_NAME(X.WORK_USER_ID, 'USER') WORK_USER_NM
             , Y.item_NO
             , Y.EQ_NM
             , X.PLAN_START_YMD
             , X.PLAN_END_YMD
             , X.START_YMD
             , X.END_YMD
             , X.REQ_NO
             , X.EQ_NO
          FROM WO0201M X
         INNER JOIN EQ0101M Y ON (Y.EQ_NO = X.EQ_NO AND Y.COMPANY_CD = X.COMPANY_CD)
          LEFT OUTER JOIN WO0101M Z ON (Z.REQ_NO = X.REQ_NO AND Z.COMPANY_CD = X.COMPANY_CD)
         WHERE X.EQ_NO IS NOT NULL
           AND Y.REV_NO = #{revNo}
           AND X.COMPANY_CD = #{companyCd}
          <if test="chartCd != null &amp;&amp; chartCd != ''">
             AND DBO.FN_NAME(X.EQ_NO, 'EQ_LINE') = #{chartCd}
          </if>
          <if test='fstatus == "comp"'>
             AND X.WO_STS = 'YZ'
          </if>
          <if test='fstatus == "undecided"'>
             AND X.WO_STS NOT IN ('YZ', 'BX', 'CX')
          </if>
          <if test='fstatus == "canceled"'>
             AND X.WO_STS IN ('BX', 'CX')
          </if>
          <if test="fStartDate != null &amp;&amp; fStartDate != ''">
             AND CONVERT(VARCHAR, ISNULL(Z.FST_REG_DT, X.FST_REG_DT), 23) <![CDATA[ >=]]> #{fStartDate}
          </if>
          <if test="fEndDate != null &amp;&amp; fEndDate != ''">
             AND CONVERT(VARCHAR, ISNULL(Z.FST_REG_DT, X.FST_REG_DT), 23) <![CDATA[ <=]]> #{fEndDate}
          </if>
         ORDER BY X.wo_no DESC
        </if>
    </select>
</mapper>