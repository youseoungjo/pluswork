<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--************************************************************************************
* Program Name : 점검데이터작성
* Description : 점검데이터작성
* Author : jit13
* Created Date :
* SQL 목록
***************************************************************************************
* SQLID                 설명
***************************************************************************************
* retrieveST0701     : 점검데이터 목록 조회
*************************************************************************************-->
<mapper namespace="st0701">
    <select id="retrieveST0701List" parameterType="map" resultType="map" >
        <![CDATA[ /* st0701.retrieveST0701List */ ]]>
        SELECT
               LINE_CD AS EQ_NO
             , (SELECT CLS_NM FROM EQ0201M WHERE CLS_CD = LINE_CD AND CLS_TYPE = 'E' AND EQ_CLS = 'EQ_PRCS' AND COMPANY_CD = #{companyCd}) AS EQ_NM
             , SUM(S001)+SUM(S002)+SUM(S003)+SUM(S004)+SUM(S005)+SUM(S006) +
               SUM(S007)+SUM(S008)+SUM(S009)+SUM(S010)+SUM(S011)+SUM(S012) +
               SUM(S013)+SUM(S014)+SUM(S015)+SUM(S016)+SUM(S017)+SUM(S018) +
               SUM(S019)+SUM(S020)+SUM(S021)+SUM(S022)+SUM(S023)+SUM(S024) +
               SUM(S025)+SUM(S026)+SUM(S027)+SUM(S028)+SUM(S029)+SUM(S030) +
               SUM(S031)+SUM(S032)+SUM(S033)+SUM(S034)+SUM(S035)+SUM(S036) +
               SUM(S037)+SUM(S038)+SUM(S039)+SUM(S040)+SUM(S041)+SUM(S042) +
               SUM(S043)+SUM(S044)+SUM(S045)+SUM(S046)+SUM(S047)+SUM(S048) +
               SUM(S049)+SUM(S050)+SUM(S051)+SUM(S052)+SUM(S053)+SUM(S054) +
               SUM(S055)+SUM(S056)+SUM(S057) TOTAL
             , SUM(S001) AS S001
             , SUM(S002) AS S002
             , SUM(S003) AS S003
             , SUM(S004) AS S004
             , SUM(S005) AS S005
             , SUM(S006) AS S006
             , SUM(S007) AS S007
             , SUM(S008) AS S008
             , SUM(S009) AS S009
             , SUM(S010) AS S010
             , SUM(S011) AS S011
             , SUM(S012) AS S012
             , SUM(S013) AS S013
             , SUM(S014) AS S014
             , SUM(S015) AS S015
             , SUM(S016) AS S016
             , SUM(S017) AS S017
             , SUM(S018) AS S018
             , SUM(S019) AS S019
             , SUM(S020) AS S020
             , SUM(S021) AS S021
             , SUM(S022) AS S022
             , SUM(S023) AS S023
             , SUM(S024) AS S024
             , SUM(S025) AS S025
             , SUM(S026) AS S026
             , SUM(S027) AS S027
             , SUM(S028) AS S028
             , SUM(S029) AS S029
             , SUM(S030) AS S030
             , SUM(S031) AS S031
             , SUM(S032) AS S032
             , SUM(S033) AS S033
             , SUM(S034) AS S034
             , SUM(S035) AS S035
             , SUM(S036) AS S036
             , SUM(S037) AS S037
             , SUM(S038) AS S038
             , SUM(S039) AS S039
             , SUM(S040) AS S040
             , SUM(S041) AS S041
             , SUM(S042) AS S042
             , SUM(S043) AS S043
             , SUM(S044) AS S044
             , SUM(S045) AS S045
             , SUM(S046) AS S046
             , SUM(S047) AS S047
             , SUM(S048) AS S048
             , SUM(S049) AS S049
             , SUM(S050) AS S050
             , SUM(S051) AS S051
             , SUM(S052) AS S052
             , SUM(S053) AS S053
             , SUM(S054) AS S054
             , SUM(S055) AS S055
             , SUM(S056) AS S056
             , SUM(S057) AS S057
          FROM (
                SELECT

                       Z.EQ_NO
                     , DBO.FN_NAME(Z.EQ_NO, 'EQ_LINE') AS LINE_CD
                     , CASE WHEN Y.SYMPTM_CD = '001' THEN 1 ELSE 0 END S001
                     , CASE WHEN Y.SYMPTM_CD = '002' THEN 1 ELSE 0 END S002
                     , CASE WHEN Y.SYMPTM_CD = '003' THEN 1 ELSE 0 END S003
                     , CASE WHEN Y.SYMPTM_CD = '004' THEN 1 ELSE 0 END S004
                     , CASE WHEN Y.SYMPTM_CD = '005' THEN 1 ELSE 0 END S005
                     , CASE WHEN Y.SYMPTM_CD = '006' THEN 1 ELSE 0 END S006
                     , CASE WHEN Y.SYMPTM_CD = '007' THEN 1 ELSE 0 END S007
                     , CASE WHEN Y.SYMPTM_CD = '008' THEN 1 ELSE 0 END S008
                     , CASE WHEN Y.SYMPTM_CD = '009' THEN 1 ELSE 0 END S009
                     , CASE WHEN Y.SYMPTM_CD = '010' THEN 1 ELSE 0 END S010
                     , CASE WHEN Y.SYMPTM_CD = '011' THEN 1 ELSE 0 END S011
                     , CASE WHEN Y.SYMPTM_CD = '012' THEN 1 ELSE 0 END S012
                     , CASE WHEN Y.SYMPTM_CD = '013' THEN 1 ELSE 0 END S013
                     , CASE WHEN Y.SYMPTM_CD = '014' THEN 1 ELSE 0 END S014
					 , CASE WHEN Y.SYMPTM_CD = '015' THEN 1 ELSE 0 END S015
					 , CASE WHEN Y.SYMPTM_CD = '016' THEN 1 ELSE 0 END S016
					 , CASE WHEN Y.SYMPTM_CD = '017' THEN 1 ELSE 0 END S017
					 , CASE WHEN Y.SYMPTM_CD = '018' THEN 1 ELSE 0 END S018
					 , CASE WHEN Y.SYMPTM_CD = '019' THEN 1 ELSE 0 END S019
					 , CASE WHEN Y.SYMPTM_CD = '020' THEN 1 ELSE 0 END S020
					 , CASE WHEN Y.SYMPTM_CD = '021' THEN 1 ELSE 0 END S021
					 , CASE WHEN Y.SYMPTM_CD = '022' THEN 1 ELSE 0 END S022
					 , CASE WHEN Y.SYMPTM_CD = '023' THEN 1 ELSE 0 END S023
					 , CASE WHEN Y.SYMPTM_CD = '024' THEN 1 ELSE 0 END S024
					 , CASE WHEN Y.SYMPTM_CD = '025' THEN 1 ELSE 0 END S025
					 , CASE WHEN Y.SYMPTM_CD = '026' THEN 1 ELSE 0 END S026
					 , CASE WHEN Y.SYMPTM_CD = '027' THEN 1 ELSE 0 END S027
					 , CASE WHEN Y.SYMPTM_CD = '028' THEN 1 ELSE 0 END S028
					 , CASE WHEN Y.SYMPTM_CD = '029' THEN 1 ELSE 0 END S029
					 , CASE WHEN Y.SYMPTM_CD = '030' THEN 1 ELSE 0 END S030
					 , CASE WHEN Y.SYMPTM_CD = '031' THEN 1 ELSE 0 END S031
					 , CASE WHEN Y.SYMPTM_CD = '032' THEN 1 ELSE 0 END S032
					 , CASE WHEN Y.SYMPTM_CD = '033' THEN 1 ELSE 0 END S033
					 , CASE WHEN Y.SYMPTM_CD = '034' THEN 1 ELSE 0 END S034
					 , CASE WHEN Y.SYMPTM_CD = '035' THEN 1 ELSE 0 END S035
					 , CASE WHEN Y.SYMPTM_CD = '036' THEN 1 ELSE 0 END S036
					 , CASE WHEN Y.SYMPTM_CD = '037' THEN 1 ELSE 0 END S037
					 , CASE WHEN Y.SYMPTM_CD = '038' THEN 1 ELSE 0 END S038
					 , CASE WHEN Y.SYMPTM_CD = '039' THEN 1 ELSE 0 END S039
					 , CASE WHEN Y.SYMPTM_CD = '040' THEN 1 ELSE 0 END S040
					 , CASE WHEN Y.SYMPTM_CD = '041' THEN 1 ELSE 0 END S041
					 , CASE WHEN Y.SYMPTM_CD = '042' THEN 1 ELSE 0 END S042
					 , CASE WHEN Y.SYMPTM_CD = '043' THEN 1 ELSE 0 END S043
					 , CASE WHEN Y.SYMPTM_CD = '044' THEN 1 ELSE 0 END S044
					 , CASE WHEN Y.SYMPTM_CD = '045' THEN 1 ELSE 0 END S045
					 , CASE WHEN Y.SYMPTM_CD = '046' THEN 1 ELSE 0 END S046
					 , CASE WHEN Y.SYMPTM_CD = '047' THEN 1 ELSE 0 END S047
					 , CASE WHEN Y.SYMPTM_CD = '048' THEN 1 ELSE 0 END S048
					 , CASE WHEN Y.SYMPTM_CD = '049' THEN 1 ELSE 0 END S049
					 , CASE WHEN Y.SYMPTM_CD = '050' THEN 1 ELSE 0 END S050
					 , CASE WHEN Y.SYMPTM_CD = '051' THEN 1 ELSE 0 END S051
					 , CASE WHEN Y.SYMPTM_CD = '052' THEN 1 ELSE 0 END S052
					 , CASE WHEN Y.SYMPTM_CD = '053' THEN 1 ELSE 0 END S053
					 , CASE WHEN Y.SYMPTM_CD = '054' THEN 1 ELSE 0 END S054
					 , CASE WHEN Y.SYMPTM_CD = '055' THEN 1 ELSE 0 END S055
					 , CASE WHEN Y.SYMPTM_CD = '056' THEN 1 ELSE 0 END S056
					 , CASE WHEN Y.SYMPTM_CD = '057' THEN 1 ELSE 0 END S057
                  FROM WO0201M X
                 INNER JOIN WO0303R Y ON (Y.WO_NO = X.WO_NO AND Y.COMPANY_CD = X.COMPANY_CD)
                 INNER JOIN EQ0101M Z ON (Z.EQ_NO = X.EQ_NO AND Z.COMPANY_CD = X.COMPANY_CD)
                 WHERE Z.REV_NO = #{revNo}
                   AND X.COMPANY_CD = #{companyCd}
                <if test="fReqOrgCd != null &amp;&amp; fReqOrgCd != ''">
                   AND UPPER(x.ORG_CD) = UPPER(#{fReqOrgCd})
                </if>
                <if test="fPlanOrgCd != null &amp;&amp; fPlanOrgCd != ''">
                   AND UPPER(x.PLAN_ORG_CD) = UPPER(#{fPlanOrgCd})
                </if>
               <if test="fStartDate != null &amp;&amp; fStartDate != ''">
                 AND X.START_YMD<![CDATA[ >= ]]> #{fStartDate}
               </if>
               <if test="fEndDate != null &amp;&amp; fEndDate != ''">
                 AND X.START_YMD<![CDATA[ <= ]]> #{fEndDate}
               </if>
                ) A
         WHERE 1=1
           <if test="flineCd != null &amp;&amp; flineCd != ''">
           AND A.LINE_CD IN (${flineCd})
           </if>
         GROUP BY LINE_CD
         ORDER BY LINE_CD
    </select>

    <select id="retrieveST0701SubList" parameterType="map" resultType="map" >
        <![CDATA[ /* st0701.retrieveST0701SubList */ ]]>
        SELECT
               X.WO_NO
             , X.COMPANY_CD
             , X.WO_NM
             , dbo.FN_NAME(X.WO_STS, 'WO_STS') WO_STS
             , Y.EQ_NM
             , X.START_YMD
             , X.END_YMD
             , dbo.FN_NAME(X.ORG_CD, 'DEPT') ORG_NM
             , dbo.FN_NAME(X.WORK_USER_ID, 'USER') WORK_USER_NM
             , (SELECT ACT_NM FROM WO0303C WHERE ACT_CD = B.SYMPTM_CD AND ACT_CLS = 'S') SYMPTM_NM
             , X.EQ_NO
          FROM WO0201M X
         INNER JOIN EQ0101M Y ON (Y.EQ_NO = X.EQ_NO AND Y.COMPANY_CD = X.COMPANY_CD)
         INNER JOIN WO0303R B ON (B.WO_NO = X.WO_NO AND B.COMPANY_CD = X.COMPANY_CD)
         WHERE Y.REV_NO = #{revNo}
           AND X.COMPANY_CD = #{companyCd}
        <if test="symptmCd != null &amp;&amp; symptmCd != ''">
           AND B.SYMPTM_CD = #{symptmCd}
        </if>
        <if test="fEqNo != null &amp;&amp; fEqNo != ''">
           AND DBO.FN_NAME(X.EQ_NO, 'EQ_LINE') = #{fEqNo}
        </if>
        <if test="fStartDate != null &amp;&amp; fStartDate != ''">
           AND X.START_YMD<![CDATA[ >= ]]> #{fStartDate}
        </if>
        <if test="fEndDate != null &amp;&amp; fEndDate != ''">
           AND X.END_YMD<![CDATA[ <= ]]> #{fEndDate}
        </if>
        <if test="fReqOrgCd != null &amp;&amp; fReqOrgCd != ''">
           AND UPPER(X.ORG_CD) = UPPER(#{fReqOrgCd})
        </if>
         ORDER BY X.WO_NO ASC
    </select>
</mapper>