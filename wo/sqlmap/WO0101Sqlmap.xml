<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--************************************************************************************
* Program Name : WO0101
* Description : 작업요청
* Author :
* Created Date :
* SQL 목록
***************************************************************************************
* SQLID                 설명
***************************************************************************************
* retrieveWO0101List : 메뉴 목록 조회
* insertWO0101 : 작업요청 목록 추가
* updateWO0101 : 작업요청 목록 수정
* deleteWO0101 : 작업요청 목록 삭제
*************************************************************************************-->
<mapper namespace="wo0101">
    <select id="retrieveWO0101List" parameterType="map" resultType="map" >
        <![CDATA[ /* wo0101.retrieveWO0101List */ ]]>
        SELECT
               X.REQ_NO
             , X.REQ_NM
             , X.COMPANY_CD
             , X.CMMNT
             , X.REQ_DESC
             , X.WO_REQ_STS
             , dbo.FN_NAME(X.WO_REQ_STS, 'WO_REQ_STS')WO_REQ_STS_NM
             , Y.ITEM_NO
             , Y.EQ_NM
             , CONVERT(VARCHAR, CONVERT(DATE, X.REQ_YMD), 23) AS REQ_YMD
             , X.REQ_TIME
             , X.REQ_ORG_CD
             , dbo.FN_NAME(X.REQ_ORG_CD, 'DEPT')REQ_ORG_CD_DESC
             , X.REQ_USER_ID
             , dbo.FN_NAME(X.REQ_USER_ID, 'USER')REQ_USER_NM
             , Z.WO_NO
             , Z.WO_STS
             , dbo.FN_NAME(Z.WO_STS, 'WO_STS') WO_STS_NM
             , Z.HOLD_YN
             , X.WO_TP
             , X.EQ_NO
             , X.FILE_ATCH_ID
             , (SELECT COUNT(*) FROM SC_FILE WHERE FILE_ATCH_ID = X.FILE_ATCH_ID) AS FILE_CNT
             , Y.EQ_TP
             , dbo.FN_NAME(Y.EQ_TP, 'EQ_TP')EQ_TP_NM
             , Y.EQ_STS
             , X.REQ_TP
             , X.RECEIPT_USER_ID
             , dbo.FN_NAME(X.RECEIPT_USER_ID, 'USER')RECEIPT_USER_NM
             , CONVERT(CHAR(16), X.RECEIPT_DT, 120) AS RECEIPT_DT
             , CONVERT(VARCHAR, CONVERT(DATE, X.BROKEN_YMD), 23) AS BROKEN_YMD
             , X.BROKEN_TIME
             , X.REPAIR_TP
             , X.CANCEL_USER_ID
             , dbo.FN_NAME(X.CANCEL_USER_ID, 'USER') AS CANCEL_USER_NM
             , CONVERT(CHAR(16), X.CANCEL_DT, 120) AS CANCEL_DT
             , X.CANCEL_DESC
             , (SELECT CLS_NM FROM EQ0201M WHERE COMPANY_CD = #{companyCd} AND PLANT_CODE = Y.PLANT_CODE AND FACTORY_CODE = Y.FACTORY_CODE AND CLS_CD = Y.EQ_LINE) AS EQ_LINE_NM
          FROM WO0101M X
          LEFT OUTER JOIN EQ0101M Y ON (Y.EQ_NO = X.EQ_NO AND Y.COMPANY_CD = X.COMPANY_CD)
          LEFT OUTER JOIN WO0201M Z ON (Z.REQ_NO = X.REQ_NO AND Z.COMPANY_CD = X.COMPANY_CD)
         WHERE Y.REV_NO = #{revNo}
           AND X.COMPANY_CD = #{companyCd}
        <if test="fReqNo != null &amp;&amp; fReqNo != ''">
           AND UPPER(X.REQ_NO) LIKE '%' + UPPER(#{fReqNo}) + '%'
        </if>
        <if test="fReqNm != null &amp;&amp; fReqNm != ''">
           AND UPPER(X.REQ_NM) LIKE '%' + UPPER(#{fReqNm}) + '%'
        </if>
        <if test="fReqSts != null &amp;&amp; fReqSts != ''">
           AND X.WO_REQ_STS IN (${fReqSts})
        </if>
        <if test="pwoNo != null &amp;&amp; pwoNo != ''">
           AND Z.WO_NO IN (${pwoNo})
        </if>
        <if test="feqNo != null &amp;&amp; feqNo != ''">
           AND UPPER(X.EQ_NO) LIKE '%' + UPPER(#{feqNo}) + '%'
        </if>
        <if test="fReqOrgCd != null &amp;&amp; fReqOrgCd != ''">
           AND UPPER(X.REQ_ORG_CD) LIKE '%' + UPPER(#{fReqOrgCd}) + '%'
        </if>
        <if test="fStartYmd != null &amp;&amp; fStartYmd != ''">
          <if test="fEndYmd != null &amp;&amp; fEndYmd != ''">
           AND X.REQ_YMD BETWEEN #{fStartYmd} AND #{fEndYmd}
          </if>
        </if>
         ORDER BY X.REQ_NO DESC
    </select>

    <select id="retrieveWO0101ListToTree" parameterType="map" resultType="map" >
        <![CDATA[ /* wo0101.retrieveWO0101ListToTree */ ]]>
        WITH EQ_SUB
          AS (SELECT CLS_CD,
                     PRNT_CLS_CD,
                     CLS_LVL,
                     COMPANY_CD
              FROM   EQ0201M
              WHERE  EQ_CLS = #{eqClsDiv}
                     AND CLS_CD IN (${eqNo})
                     AND COMPANY_CD = #{companyCd}
              UNION ALL
              SELECT M.CLS_CD,
                     M.PRNT_CLS_CD,
                     M.CLS_LVL,
                     M.COMPANY_CD
              FROM   EQ0201M M
                     JOIN EQ_SUB N
                       ON N.CLS_CD = M.PRNT_CLS_CD AND N.COMPANY_CD = M.COMPANY_CD
              WHERE  1 = 1)
        SELECT
               X.REQ_NO
             , X.COMPANY_CD
             , X.REQ_NM
             , X.CMMNT
             , X.REQ_DESC
             , X.WO_REQ_STS
             , dbo.FN_NAME(X.WO_REQ_STS, 'WO_REQ_STS')WO_REQ_STS_NM
             , Y.ITEM_NO
             , Y.EQ_NM
             , CONVERT(VARCHAR, CONVERT(DATE, X.REQ_YMD), 23) AS REQ_YMD
             , X.REQ_TIME
             , X.REQ_ORG_CD
             , dbo.FN_NAME(X.REQ_ORG_CD, 'DEPT')REQ_ORG_CD_DESC
             , X.REQ_USER_ID
             , dbo.FN_NAME(X.REQ_USER_ID, 'USER')REQ_USER_NM
             , Z.WO_NO
             , Z.WO_STS
             , dbo.FN_NAME(Z.WO_STS, 'WO_STS') WO_STS_NM
             , Z.HOLD_YN
             , X.WO_TP
             , X.EQ_NO
             , X.FILE_ATCH_ID
             , Y.EQ_TP
             , dbo.FN_NAME(Y.EQ_TP, 'EQ_TP')EQ_TP_NM
             , Y.EQ_STS
             , X.REQ_TP
             , X.RECEIPT_USER_ID
             , dbo.FN_NAME(X.RECEIPT_USER_ID, 'USER')RECEIPT_USER_NM
             , CONVERT(CHAR(16), X.RECEIPT_DT, 120) AS RECEIPT_DT
             , CONVERT(VARCHAR, CONVERT(DATE, X.BROKEN_YMD), 23) AS BROKEN_YMD
             , X.BROKEN_TIME
             , X.REPAIR_TP
             , X.CANCEL_USER_ID
             , dbo.FN_NAME(X.CANCEL_USER_ID, 'USER') AS CANCEL_USER_NM
             , CONVERT(CHAR(16), X.CANCEL_DT, 120) AS CANCEL_DT
             , X.CANCEL_DESC
             , (SELECT CLS_NM FROM EQ0201M WHERE COMPANY_CD = #{companyCd} AND PLANT_CODE = Y.PLANT_CODE AND FACTORY_CODE = Y.FACTORY_CODE AND CLS_CD = Y.EQ_LINE) AS EQ_LINE_NM
          FROM WO0101M X
          LEFT OUTER JOIN EQ0101M Y ON (Y.EQ_NO = X.EQ_NO AND Y.COMPANY_CD = X.COMPANY_CD)
          LEFT OUTER JOIN WO0201M Z ON (Z.REQ_NO = X.REQ_NO AND Z.COMPANY_CD = X.COMPANY_CD)
         WHERE Y.REV_NO = #{revNo}
           AND X.COMPANY_CD = #{companyCd}
         <if test="eqClsDiv == 'EQ_TP'">
          AND Y.EQ_TP IN (
              SELECT CLS_CD FROM EQ_SUB
              )
         </if>
         <if test="eqClsDiv == 'EQ_LOC'">
          AND Y.EQ_LOC IN (
                SELECT CLS_CD FROM EQ_SUB
              )
         </if>
         <if test="eqClsDiv == 'EQ_PRCS'">
          AND Y.EQ_PRCS IN (
                SELECT CLS_CD FROM EQ_SUB
              )
         </if>
         <if test="eqClsDiv == 'EQ_MY'">
          AND Y.EQ_PRCS IN (
                 SELECT EQ_PRCS
                  FROM EQ0101M
                 WHERE 1=1
                   AND EQ_NO IN (${eqNo})
                   AND COMPANY_CD = #{companyCd}
              )
          AND Y.EQ_NO IN (SELECT EQ_NO FROM EQ0101P WHERE USE_YN = 'Y' AND USER_ID = #{userId} AND COMPANY_CD = #{companyCd})
         </if>
         <if test="fStartYmd != null &amp;&amp; fStartYmd != ''">
          <if test="fEndYmd != null &amp;&amp; fEndYmd != ''">
           AND X.REQ_YMD BETWEEN #{fStartYmd} AND #{fEndYmd}
          </if>
        </if>
         ORDER BY X.REQ_NO DESC
    </select>

    <select id="retrieveSymptmList" parameterType="map" resultType="map" >
        <![CDATA[ /* wo0101.retrieveSymptmList */ ]]>
        SELECT
               X.REQ_SMPTM_NO
             , X.COMPANY_CD
             , X.SYMPTM_CD
             , X.REQ_NO
             , X.CMMNT
             , (SELECT ACT_NM FROM WO0303C WHERE ACT_CD = X.SYMPTM_CD AND ACT_CLS = 'S' AND USE_YN = 'Y') AS SYMPTM_DESC
          FROM WO0102M x
         WHERE X.REQ_NO = #{reqNo}
           AND X.COMPANY_CD = #{companyCd}
         ORDER BY REQ_SMPTM_NO ASC
    </select>


    <insert id="insertWO0101" parameterType="map" >
        <![CDATA[ /* wo0101.insertWO0101 */ ]]>
        INSERT INTO WO0101M (
               REQ_NO
             , COMPANY_CD
             , REQ_NM
             , WO_TP
             , WO_REQ_STS
             , EQ_NO
             , REQ_YMD
             , REQ_TIME
             , REQ_ORG_CD
             , REQ_USER_ID
             , CMMNT
             , REQ_DESC
             , FILE_ATCH_ID
             , REQ_TP
             , RECEIPT_USER_ID
			 , BROKEN_YMD
			 , BROKEN_TIME
			 , REPAIR_TP
             , FST_REG_USER_ID
             , FST_REG_DT
             , FNL_EDIT_USER_ID
             , FNL_EDIT_DT
        )
        VALUES (
               #{reqNo}
             , #{companyCd}
             , #{reqNm}
             , #{woTp}
             , #{woReqSts}
             , #{eqNo}
             , #{reqYmd}
             , #{reqTime}
             , #{reqOrgCd}
             , #{reqUserId}
             , #{cmmnt}
             , #{reqDesc}
             <if test="fileAtchId == ''">
             , null
             </if>
             <if test="fileAtchId != ''">
             , #{fileAtchId}
             </if>
             , #{reqTp}
             , #{receiptUserId}
             , #{brokenYmd}
             , #{brokenTime}
             , #{repairTp}
             , #{fstRegUserId}
             , GETDATE()
             , #{fnlEditUserId}
             , GETDATE()
        )

    </insert>

    <!-- 해당 설비ID정보 수정 -->
    <update id="updateWO0101" parameterType="map" >
        <![CDATA[ /* wo0101.updateWO0101 */ ]]>
        UPDATE WO0101M
           SET
               REQ_NM            = #{reqNm}
             , EQ_NO             = #{eqNo}
             , WO_TP             = #{woTp}
             <if test="fileAtchId == ''">
             , FILE_ATCH_ID     = null
             </if>
             <if test="fileAtchId != ''">
             , FILE_ATCH_ID     = #{fileAtchId}
             </if>
             , CMMNT             = #{cmmnt}
             , REQ_DESC          = #{reqDesc}
             , REQ_TP            = #{reqTp}
             , RECEIPT_USER_ID   = #{receiptUserId}
			 , BROKEN_YMD        = #{brokenYmd}
			 , BROKEN_TIME       = #{brokenTime}
			 , REQ_YMD           = #{reqYmd}
			 , REQ_TIME          = #{reqTime}
			 , REPAIR_TP         = #{repairTp}
             , FNL_EDIT_DT       = GETDATE()
             , FNL_EDIT_USER_ID  = #{fnlEditUserId}
         WHERE REQ_NO            = #{reqNo}
           AND COMPANY_CD        = #{companyCd}
    </update>

    <!-- 해당 설비ID 삭제 -->
    <delete id="deleteWO0101" parameterType="map" >
        <![CDATA[ /* wo0101.deleteWO0101 */ ]]>
        DELETE
          FROM WO0101M
         WHERE REQ_NO     = #{reqNo}
           AND COMPANY_CD = #{companyCd}
    </delete>

    <!-- 작업요청서 현상 저장  -->
    <insert id="insertSymList" parameterType="map" >
        <![CDATA[ /* wo0101.insertSymList */ ]]>
        INSERT INTO WO0102M (
               REQ_SMPTM_NO
             , COMPANY_CD
             , SYMPTM_CD
             , REQ_NO
             , CMMNT
             , FST_REG_USER_ID
             , FST_REG_DT
        )
        VALUES (
               NEXT VALUE FOR DBO.SQREQ_SMPTM_NO_01
             , #{companyCd}
             , #{symptmCd}
             , #{reqNo}
             , #{cmmnt}
             , #{fstRegUserId}
             , GETDATE()
        )
    </insert>

    <!-- 작업요청서 현상 수정 -->
    <update id="updateSymList" parameterType="map" >
        <![CDATA[ /* wo0101.updateSymList */ ]]>
        UPDATE WO0102M
           SET
               SYMPTM_CD         = #{symptmCd}
             , CMMNT             = #{cmmnt}
             , FNL_EDIT_DT       = GETDATE()
             , FNL_EDIT_USER_ID  = #{fnlEditUserId}
            WHERE REQ_SMPTM_NO   = #{reqSmptmNo}
              AND COMPANY_CD     = #{companyCd}
    </update>

    <!-- 작업요청서 현상 삭제 -->
    <delete id="deleteSymList" parameterType="map" >
        <![CDATA[ /* wo0101.deleteSymList */ ]]>
        DELETE
          FROM WO0102M
            WHERE REQ_SMPTM_NO   = #{reqSmptmNo}
              AND COMPANY_CD     = #{companyCd}
    </delete>


    <select id="retrieveEqAtchId" parameterType="map" resultType="map">
        <![CDATA[ /* wo0101.retrieveEqAtchId */ ]]>
        SELECT CONVERT(VARCHAR, FILE_ATCH_ID) AS FILE_ATCH_ID
          FROM EQ0101M
         WHERE EQ_NO = #{eqNo}
           AND COMPANY_CD = #{companyCd}
           AND REV_NO = #{revNo}
    </select>

    <select id="retrieveWO0101Detail" parameterType="map" resultType="map" >
       <![CDATA[ /* wo0101.retrieveWO0101Detail */ ]]>
       SELECT
              X.REQ_NO
            , X.REQ_NM
            , X.COMPANY_CD
            , X.CMMNT
            , X.REQ_DESC
            , X.WO_REQ_STS
            , dbo.FN_NAME(X.WO_REQ_STS, 'WO_REQ_STS')WO_REQ_STS_NM
            , Y.ITEM_NO
            , Y.EQ_NM
            , X.REQ_YMD
            , X.REQ_ORG_CD
            , dbo.FN_NAME(X.REQ_ORG_CD, 'DEPT')REQ_ORG_CD_DESC
            , X.REQ_USER_ID
            , dbo.FN_NAME(X.REQ_USER_ID, 'USER')REQ_USER_NM
            , Z.WO_NO
            , dbo.FN_NAME(Z.WO_STS, 'WO_STS') WO_STATUS
            , Z.HOLD_YN
            , X.WO_TP
            , dbo.FN_NAME(X.WO_TP, 'WO_TP')WO_TP_NM
            , X.EQ_NO
            , X.FILE_ATCH_ID
         FROM WO0101M X
		 LEFT OUTER JOIN EQ0101M Y ON (Y.EQ_NO = X.EQ_NO AND Y.COMPANY_CD = X.COMPANY_CD)
		 LEFT OUTER JOIN WO0201M Z ON (Z.REQ_NO = X.REQ_NO AND Z.COMPANY_CD = X.COMPANY_CD)
        WHERE Y.REV_NO = #{revNo}
          AND X.COMPANY_CD = #{companyCd}
          AND X.REQ_NO = #{reqNo}
    </select>

    <!-- 요청 취소 -->
    <update id="updateReqCancelWO0101" parameterType="map" >
        <![CDATA[ /* wo0101.updateReqCancelWO0101 */ ]]>
        UPDATE WO0101M
           SET
               WO_REQ_STS        = 'AX'
             , CANCEL_USER_ID    = #{reqUserId}
             , CANCEL_DT        = GETDATE()
             , CANCEL_DESC       = #{cancelDesc}
             , FNL_EDIT_DT       = GETDATE()
             , FNL_EDIT_USER_ID  = #{fnlEditUserId}
         WHERE REQ_NO            = #{reqNo}
           AND REQ_USER_ID = #{reqUserId}
           AND COMPANY_CD  = #{companyCd}
           AND WO_REQ_STS  = 'AR'
    </update>

    <!-- 작업결과서 저장  -->
    <insert id="insertWO0201" parameterType="map" >
        <![CDATA[ /* wo0101.insertWO0201 */ ]]>
        INSERT INTO WO0201M (
               WO_NO
             , REQ_NO
             , COMPANY_CD
             , WO_STS
             , EQ_NO
             , EQ_GRD
             , WO_TP
             , WO_DIV
             <if test="woSts == 'CA'">
             , ORG_CD
             , WORK_USER_ID
             , START_YMD
             , START_TIME
             </if>
             <if test="woSts == 'BA'">
             , PLAN_ORG_CD
             , PLAN_USER_ID
             , ORG_CD
             , WORK_USER_ID
             </if>
             , BROKEN_START_YMD
             , BROKEN_START_TIME
             , DEVICE_TP
             , FST_REG_USER_ID
             , FST_REG_DT
             , FNL_EDIT_USER_ID
             , FNL_EDIT_DT
             , FILE_ATCH_ID
             , REPAIR_TP
        ) VALUES (
               #{woNo}
             , #{reqNo}
             , #{companyCd}
             , #{woSts}
             , #{eqNo}
             , (SELECT EQ_GRD FROM EQ0101M WHERE EQ_NO = #{eqNo})
             , #{woTp}
             , #{woDiv}
             <if test="woSts == 'CA'">
             , (SELECT ORG_CD FROM SC_USER WHERE USER_ID = #{workUserId})
             , #{workUserId}
             , CONVERT(VARCHAR, GETDATE(), 23)
             , LEFT(CONVERT(VARCHAR, GETDATE(), 8),5)
             </if>
             <if test="woSts == 'BA'">
             , (SELECT ORG_CD FROM SC_USER WHERE USER_ID = #{planUserId})
             , #{planUserId}
             , (SELECT ORG_CD FROM SC_USER WHERE USER_ID = #{planUserId})
             , #{planUserId}
             </if>
             , #{brokenYmd}
             , #{brokenTime}
             , 'PC'
             , #{fstRegUserId}
             , GETDATE()
             , #{fnlEditUserId}
             , GETDATE()
             <if test="fileAtchId == ''">
             , null
             </if>
             <if test="fileAtchId != ''">
             , #{fileAtchId}
             </if>
             , #{repairTp}
        )
    </insert>


    <!-- 현상 정보 저장  -->
    <insert id="insertWO0303S" parameterType="map" >
        <![CDATA[ /* wo0101.insertWO0303S */ ]]>
        INSERT INTO WO0303S (
               WO_SYMPTM_NO
             , SYMPTM_CD
             , WO_NO
             , COMPANY_CD
             , CMMNT
             , WO_DIV
             , FST_REG_USER_ID
             , FST_REG_DT
             , FNL_EDIT_USER_ID
             , FNL_EDIT_DT
        )
        VALUES (
               NEXT VALUE FOR DBO.SQWO_SYMPTM_NO_01
             , #{symptmCd}
             , #{woNo}
             , #{companyCd}
             , #{cmmnt}
             , #{woDiv}
             , #{fstRegUserId}
             , GETDATE()
             , #{fnlEditUserId}
             , GETDATE()
        )
    </insert>

    <select id="retreieveNextWoNoSeq" resultType="map" >
        <![CDATA[ /* wo0101.retreieveNextWoNoSeq */ ]]>
        SELECT NEXT VALUE FOR DBO.SQWO_NO_01 WO_NO
    </select>

    <insert id="createWO0303S" parameterType="map" >
       <![CDATA[ /* wo0101.createWO0303S */ ]]>
       INSERT INTO WO0303S (
              WO_SYMPTM_NO
            , SYMPTM_CD
            , WO_NO
            , COMPANY_CD
            , CMMNT
            , FST_REG_USER_ID
            , FST_REG_DT
            , FNL_EDIT_USER_ID
            , FNL_EDIT_DT
       )
       SELECT
              NEXT VALUE FOR DBO.SQWO_SYMPTM_NO_01
            , X.SYMPTM_CD
            , #{woNo}
            , #{companyCd}
            , X.CMMNT
            , #{fstRegUserId}
            , GETDATE()
            , #{fnlEditUserId}
            , GETDATE()
         FROM WO0102M X
        WHERE X.REQ_NO = #{reqNo}
    </insert>

    <insert id="createWO0302C" parameterType="map" >
       <![CDATA[ /* wo0101.createWO0302C */ ]]>
       INSERT INTO WO0302C (
              WO_OCCPT_NO
            , COMPANY_CD
            , SEQ_NO
            , WORK_USER_ID
            , WORK_HOUR
            , IN_OUT_DIV
            , WO_NO
            , FST_REG_USER_ID
            , FST_REG_DT
            , FNL_EDIT_USER_ID
            , FNL_EDIT_DT
       ) VALUES (
              NEXT VALUE FOR DBO.SQWO_OCCPT_NO_01
            , #{companyCd}
            , 10
            , #{workUserId}
            , 0
            , '1'
            , #{woNo}
            , #{fstRegUserId}
            , GETDATE()
            , #{fnlEditUserId}
            , GETDATE()
         )
    </insert>


    <update id="updateEqSts" parameterType="map" >
        <![CDATA[ /* wo0101.updateEqSts */ ]]>
        UPDATE EQ0101M
           SET
               EQ_STS       = #{eqSts}
             , FNL_EDIT_DT       = GETDATE()
             , FNL_EDIT_USER_ID  = #{fnlEditUserId}
         WHERE EQ_NO            = #{eqNo}
           AND COMPANY_CD = #{companyCd}
    </update>

    <update id="updateReqAccep" parameterType="map" >
        <![CDATA[ /* wo0101.updateReqAccep */ ]]>
        UPDATE WO0101M
           SET
               RECEIPT_USER_ID       = #{receiptUserId}
             , WO_REQ_STS            = #{woReqSts}
             , RECEIPT_DT            = GETDATE()
             , FNL_EDIT_DT           = GETDATE()
             , FNL_EDIT_USER_ID      = #{fnlEditUserId}
         WHERE REQ_NO                = #{reqNo}
           AND WO_REQ_STS            = 'AA'
           AND COMPANY_CD            = #{companyCd}
    </update>

    <select id="retrieveReqAccepChk" parameterType="map" resultType="map" >
    	SELECT CASE COUNT(*) WHEN 0 THEN 'Y' ELSE 'N' END CHK_YN FROM WO0101M WHERE REQ_NO = #{reqNo} AND WO_REQ_STS = #{woReqSts} AND COMPANY_CD = #{companyCd}
    </select>

    <update id="updateWoReqSts" parameterType="map" >
        <![CDATA[ /* wo0101.updateWoReqSts */ ]]>
        UPDATE WO0101M
           SET
               WO_REQ_STS        = #{woReqSts}
             , FNL_EDIT_DT       = GETDATE()
             , FNL_EDIT_USER_ID  = #{fnlEditUserId}
         WHERE REQ_NO            = #{reqNo}
           AND WO_REQ_STS        = 'AR'
           AND COMPANY_CD        = #{companyCd}
    </update>


    <update id="reqUserConfirm" parameterType="map" >
        <![CDATA[ /* wo0101.reqUserConfirm */ ]]>
        UPDATE WO0201M
           SET
               WO_STS               = #{woSts}
             , FST_PROD_CHK         = #{fstProdChk}
             , FST_PROD_CHK_USER_ID = #{fstProdChkUserId}
             , FNL_EDIT_DT          = GETDATE()
             , FNL_EDIT_USER_ID     = #{fnlEditUserId}
         WHERE WO_NO                = #{woNo}
           AND COMPANY_CD           = #{companyCd}
           AND WO_STS               = 'CZ'
    </update>


    <select id="chkCreateWorkOrder" resultType="map" >
        <![CDATA[ /* wo0101.chkCreateWorkOrder */ ]]>
        SELECT COUNT(REQ_NO) AS CREATE_CNT FROM WO0201M WHERE REQ_NO = #{reqNo} AND COMPANY_CD = #{companyCd}
    </select>


</mapper>
